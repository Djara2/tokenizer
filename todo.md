- [x] Fix segfaults
- [x] Update token types during main loop. Maybe use a big function that does the analysis each time before calling `tokens_advance`
- [ ] Determine cause of regression that causes an empty token after reading a right parenthesis.
